<!DOCTYPE html>
<html>
<head>
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>
<body>
  <h3>Create One-Time Secret</h3>
  <textarea id="secret" rows="4" cols="40" placeholder="Enter your secret..."></textarea><br>
  <button onclick="createSecret()">Generate Link</button>

  <script>
    async function createSecret() {
      const secretText = document.getElementById("secret").value;

      const response = await fetch("https://onetimesecret.com/api/v1/share", {
        method: "POST",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "secret=" + encodeURIComponent(secretText)
      });

      if (response.ok) {
        const data = await response.json();
        const link = "https://ca.onetimesecret.com/secret/" + data.secret_key;

        // Insert into the email body
        Office.context.mailbox.item.body.setSelectedDataAsync(
          link,
          { coercionType: Office.CoercionType.Html }
        );

        alert("Secret link inserted into email:\n" + link);
      } else {
        alert("Error creating secret: " + await response.text());
      }
    }
  </script>
</body>
</html>
